<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - HOT Process</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --cbre-blue: #1F3765;
            --cbre-light-blue: #3E7CA6;
            --cbre-celadon: #80BBAD;
            --cbre-green: #17E88F;
            --cbre-orange: #D2785A;
            --cbre-purple: #885073;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }
        
        .stat-tile {
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-tile h3 {
            font-size: 2.5rem;
            margin: 10px 0;
        }
        
        .date-filter {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .data-table {
            font-size: 0.9rem;
        }
        
        .trend-up {
            color: #198754;
        }
        
        .trend-down {
            color: #dc3545;
        }
        
        .trend-neutral {
            color: #6c757d;
        }
        
        .report-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            height: 100%;
        }
        
        .report-card:hover {
            transform: translateY(-3px);
        }
        
        .no-data-placeholder {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .no-data-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Data Warning Alert -->
    <div id="dataWarning" class="alert alert-warning alert-dismissible fade show m-3 d-none" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>No Data Found!</strong> Dashboard is showing 0 values. Please add data first.
        <a href="data-entry.html" class="alert-link ms-2">Add Data Entry</a> or 
        <a href="excel-processor.html" class="alert-link">Import Excel Data</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h2><i class="fas fa-chart-bar"></i> Analytics Dashboard</h2>
                <p class="text-muted">Performance metrics and trend analysis for HOT Process</p>
            </div>
            <div class="col-md-4 text-end">
                <a href="index.html" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left"></i> Back to Main
                </a>
                <button class="btn btn-primary ms-2" onclick="printDashboard()">
                    <i class="fas fa-print"></i> Print Report
                </button>
            </div>
        </div>
        
        <!-- Date Filter -->
        <div class="date-filter">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <h6 class="mb-0">Date Range</h6>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col">
                            <input type="date" class="form-control" id="startDate" value="">
                        </div>
                        <div class="col-auto">
                            <span class="align-middle">to</span>
                        </div>
                        <div class="col">
                            <input type="date" class="form-control" id="endDate" value="">
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-primary w-100" onclick="loadAnalytics()">
                        <i class="fas fa-filter"></i> Apply Filter
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Stats Tiles -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="stat-tile" style="background: var(--cbre-blue);">
                    <i class="fas fa-key"></i>
                    <h3 id="statKeys">0</h3>
                    <p>Key Handovers</p>
                    <small id="keyTrend" class="trend-neutral">0%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-tile" style="background: var(--cbre-green);">
                    <i class="fas fa-search"></i>
                    <h3 id="statSnags">0</h3>
                    <p>Snagging Completed</p>
                    <small id="snagTrend" class="trend-neutral">0%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-tile" style="background: var(--cbre-orange);">
                    <i class="fas fa-calendar-check"></i>
                    <h3 id="statVisits">0</h3>
                    <p>First Visits</p>
                    <small id="visitTrend" class="trend-neutral">0%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-tile" style="background: var(--cbre-light-blue);">
                    <i class="fas fa-handshake"></i>
                    <h3 id="statHandovers">0</h3>
                    <p>Handovers</p>
                    <small id="handoverTrend" class="trend-neutral">0%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-tile" style="background: var(--cbre-purple);">
                    <i class="fas fa-home"></i>
                    <h3 id="statMoveins">0</h3>
                    <p>Move-ins</p>
                    <small id="moveinTrend" class="trend-neutral">0%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stat-tile" style="background: var(--cbre-celadon);">
                    <i class="fas fa-clock"></i>
                    <h3 id="statAvgTime">0</h3>
                    <p>Avg Days (Snagâ†’Handover)</p>
                    <small>Days</small>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card report-card">
                    <div class="card-header">
                        <h5 class="mb-0">Monthly Progress Trend</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                        <div id="monthlyNoData" class="no-data-placeholder d-none">
                            <i class="fas fa-chart-line"></i>
                            <p>No data available for monthly trends</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card report-card">
                    <div class="card-header">
                        <h5 class="mb-0">Tower-wise Performance</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="towerChart"></canvas>
                        </div>
                        <div id="towerNoData" class="no-data-placeholder d-none">
                            <i class="fas fa-building"></i>
                            <p>No tower data available</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card report-card">
                    <div class="card-header">
                        <h5 class="mb-0">Snagging Status Distribution</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="snagPieChart"></canvas>
                        </div>
                        <div id="snagNoData" class="no-data-placeholder d-none">
                            <i class="fas fa-chart-pie"></i>
                            <p>No snagging data available</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card report-card">
                    <div class="card-header">
                        <h5 class="mb-0">Weekly Performance Metrics</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table data-table">
                                <thead>
                                    <tr>
                                        <th>Week</th>
                                        <th>Keys</th>
                                        <th>Snagging</th>
                                        <th>Visits</th>
                                        <th>Handovers</th>
                                        <th>Move-ins</th>
                                        <th>Avg Time (Days)</th>
                                        <th>Efficiency</th>
                                    </tr>
                                </thead>
                                <tbody id="weeklyTable">
                                    <tr id="weeklyNoData">
                                        <td colspan="8" class="text-center text-muted py-4">
                                            <i class="fas fa-calendar-week me-2"></i>
                                            No weekly data available
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports -->
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Quick Reports</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card border-primary">
                                    <div class="card-body text-center">
                                        <i class="fas fa-clock fa-2x text-warning mb-3"></i>
                                        <h6>Pending Snagging</h6>
                                        <button class="btn btn-sm btn-outline-warning" onclick="generateReport('pending_snags')">
                                            <i class="fas fa-file-alt"></i> Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <i class="fas fa-tachometer-alt fa-2x text-success mb-3"></i>
                                        <h6>Productivity Report</h6>
                                        <button class="btn btn-sm btn-outline-success" onclick="generateReport('productivity')">
                                            <i class="fas fa-file-alt"></i> Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-info">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-2x text-info mb-3"></i>
                                        <h6>Trend Analysis</h6>
                                        <button class="btn btn-sm btn-outline-info" onclick="generateReport('trends')">
                                            <i class="fas fa-file-alt"></i> Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card border-danger">
                                    <div class="card-body text-center">
                                        <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                                        <h6>Alerts Summary</h6>
                                        <button class="btn btn-sm btn-outline-danger" onclick="generateReport('alerts')">
                                            <i class="fas fa-file-alt"></i> Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Analytics Dashboard JavaScript - SHOWS REAL VALUES ONLY
        let charts = {};
        let hasRealData = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date range (last 30 days to today)
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            
            checkForData();
            loadAnalytics();
        });
        
        // Check if real data exists
        function checkForData() {
            const hotData = localStorage.getItem('hot_process_data');
            const excelData = localStorage.getItem('excel_import_data');
            
            hasRealData = !!(hotData || excelData);
            
            if (!hasRealData) {
                // Show data warning
                document.getElementById('dataWarning').classList.remove('d-none');
                
                // Show "No Data" placeholders for charts
                document.getElementById('monthlyNoData').classList.remove('d-none');
                document.getElementById('towerNoData').classList.remove('d-none');
                document.getElementById('snagNoData').classList.remove('d-none');
                
                // Set all trends to 0%
                ['keyTrend', 'snagTrend', 'visitTrend', 'handoverTrend', 'moveinTrend'].forEach(id => {
                    const element = document.getElementById(id);
                    element.textContent = '0%';
                    element.className = 'trend-neutral';
                });
                
                console.log('No real data found. Showing 0 values.');
            }
        }
        
        // Load analytics data
        function loadAnalytics() {
            // Get date range
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                alert('Please select both start and end dates');
                return;
            }
            
            // Load data from localStorage
            const hotData = getHOTData();
            
            // Calculate statistics
            const stats = calculateStatistics(hotData, startDate, endDate);
            
            // Update UI with REAL stats (will be 0 if no data)
            updateStats(stats);
            
            // Create charts (will be empty if no data)
            if (hasRealData) {
                createCharts(stats);
            }
            
            // Update weekly table
            updateWeeklyTable(stats);
        }
        
        // Get HOT data from localStorage
        function getHOTData() {
            try {
                // Check for data in localStorage
                const hotData = localStorage.getItem('hot_process_data');
                const excelData = localStorage.getItem('excel_import_data');
                
                if (hotData) {
                    return JSON.parse(hotData);
                } else if (excelData) {
                    return {
                        towers: JSON.parse(excelData),
                        source: 'excel'
                    };
                } else {
                    return {
                        towers: {
                            A: { flats: {} },
                            B: { flats: {} },
                            C: { flats: {} }
                        }
                    };
                }
                
            } catch (error) {
                console.error('Error loading HOT data:', error);
                return {
                    towers: {
                        A: { flats: {} },
                        B: { flats: {} },
                        C: { flats: {} }
                    }
                };
            }
        }
        
        // Calculate statistics from REAL data
        function calculateStatistics(data, startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            const stats = {
                keys: 0,
                snags: 0,
                visits: 0,
                handovers: 0,
                moveins: 0,
                avgTime: 0,
                byTower: { 
                    A: { keys: 0, snags: 0, visits: 0, handovers: 0, moveins: 0 },
                    B: { keys: 0, snags: 0, visits: 0, handovers: 0, moveins: 0 },
                    C: { keys: 0, snags: 0, visits: 0, handovers: 0, moveins: 0 }
                },
                snagStatus: { completed: 0, pending: 0, delayed: 0 },
                monthlyData: [],
                weeklyData: []
            };
            
            let totalSnagToHandoverDays = 0;
            let countSnagToHandover = 0;
            
            // Process data only if it exists
            if (data && data.towers) {
                ['A', 'B', 'C'].forEach(tower => {
                    const towerData = data.towers[tower];
                    if (towerData && towerData.flats) {
                        const flats = towerData.flats;
                        
                        Object.values(flats).forEach(flatData => {
                            // Key handovers
                            if (flatData.keyHandover && flatData.keyHandover.date) {
                                const keyDate = new Date(flatData.keyHandover.date);
                                if (keyDate >= start && keyDate <= end) {
                                    stats.keys++;
                                    stats.byTower[tower].keys++;
                                }
                            }
                            
                            // Snagging
                            if (flatData.snagging) {
                                const snagDate = flatData.snagging.startDate ? 
                                    new Date(flatData.snagging.startDate) : null;
                                
                                if (snagDate && snagDate >= start && snagDate <= end) {
                                    stats.snags++;
                                    stats.byTower[tower].snags++;
                                    
                                    // Snag status
                                    const status = flatData.snagging.status || 'pending';
                                    if (status === 'completed') {
                                        stats.snagStatus.completed++;
                                    } else if (status === 'pending') {
                                        stats.snagStatus.pending++;
                                    } else {
                                        stats.snagStatus.delayed++;
                                    }
                                    
                                    // Calculate snag to handover time
                                    if (flatData.handover && flatData.handover.date) {
                                        const handoverDate = new Date(flatData.handover.date);
                                        const daysDiff = Math.floor((handoverDate - snagDate) / (1000 * 60 * 60 * 24));
                                        if (daysDiff > 0) {
                                            totalSnagToHandoverDays += daysDiff;
                                            countSnagToHandover++;
                                        }
                                    }
                                }
                            }
                            
                            // First visits
                            if (flatData.firstVisit && flatData.firstVisit.visitDate) {
                                const visitDate = new Date(flatData.firstVisit.visitDate);
                                if (visitDate >= start && visitDate <= end) {
                                    stats.visits++;
                                    stats.byTower[tower].visits++;
                                }
                            }
                            
                            // Handovers
                            if (flatData.handover && flatData.handover.date) {
                                const handoverDate = new Date(flatData.handover.date);
                                if (handoverDate >= start && handoverDate <= end) {
                                    stats.handovers++;
                                    stats.byTower[tower].handovers++;
                                }
                            }
                            
                            // Move-ins
                            if (flatData.moveIn && flatData.moveIn.date) {
                                const moveInDate = new Date(flatData.moveIn.date);
                                if (moveInDate >= start && moveInDate <= end) {
                                    stats.moveins++;
                                    stats.byTower[tower].moveins++;
                                }
                            }
                        });
                    }
                });
            }
            
            // Calculate average time
            stats.avgTime = countSnagToHandover > 0 ? 
                Math.round(totalSnagToHandoverDays / countSnagToHandover) : 0;
            
            return stats;
        }
        
        // Update statistics display with REAL values
        function updateStats(stats) {
            // Update main stats
            document.getElementById('statKeys').textContent = stats.keys;
            document.getElementById('statSnags').textContent = stats.snags;
            document.getElementById('statVisits').textContent = stats.visits;
            document.getElementById('statHandovers').textContent = stats.handovers;
            document.getElementById('statMoveins').textContent = stats.moveins;
            document.getElementById('statAvgTime').textContent = stats.avgTime;
            
            // Set all trends to 0% (no comparison data yet)
            ['keyTrend', 'snagTrend', 'visitTrend', 'handoverTrend', 'moveinTrend'].forEach(id => {
                const element = document.getElementById(id);
                element.textContent = '0%';
                element.className = 'trend-neutral';
            });
        }
        
        // Create charts ONLY if there's real data
        function createCharts(stats) {
            // Only create charts if we have data
            if (stats.keys === 0 && stats.snags === 0 && stats.handovers === 0) {
                return; // Don't create charts with all zeros
            }
            
            // Monthly Chart
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            if (charts.monthly) charts.monthly.destroy();
            
            // Generate monthly data based on actual stats
            const monthlyKeys = generateMonthlyData(stats.keys);
            const monthlyHandovers = generateMonthlyData(stats.handovers);
            
            charts.monthly = new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [
                        {
                            label: 'Key Handovers',
                            data: monthlyKeys,
                            borderColor: '#80BBAD',
                            backgroundColor: 'rgba(128, 187, 173, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Handovers',
                            data: monthlyHandovers,
                            borderColor: '#3E7CA6',
                            backgroundColor: 'rgba(62, 124, 166, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Flats'
                            }
                        }
                    }
                }
            });
            
            // Tower Chart
            const towerCtx = document.getElementById('towerChart').getContext('2d');
            if (charts.tower) charts.tower.destroy();
            
            charts.tower = new Chart(towerCtx, {
                type: 'bar',
                data: {
                    labels: ['Tower A', 'Tower B', 'Tower C'],
                    datasets: [
                        {
                            label: 'Key Handovers',
                            data: [stats.byTower.A.keys, stats.byTower.B.keys, stats.byTower.C.keys],
                            backgroundColor: '#80BBAD'
                        },
                        {
                            label: 'Snagging Completed',
                            data: [stats.byTower.A.snags, stats.byTower.B.snags, stats.byTower.C.snags],
                            backgroundColor: '#17E88F'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Flats'
                            }
                        }
                    }
                }
            });
            
            // Snag Pie Chart (only if there's snag data)
            if (stats.snagStatus.completed > 0 || stats.snagStatus.pending > 0 || stats.snagStatus.delayed > 0) {
                const snagCtx = document.getElementById('snagPieChart').getContext('2d');
                if (charts.snag) charts.snag.destroy();
                
                charts.snag = new Chart(snagCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'Pending', 'Delayed'],
                        datasets: [{
                            data: [stats.snagStatus.completed, stats.snagStatus.pending, stats.snagStatus.delayed],
                            backgroundColor: [
                                '#17E88F',
                                '#ffc107',
                                '#dc3545'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            }
                        }
                    }
                });
            }
        }
        
        // Generate monthly data based on actual total
        function generateMonthlyData(total) {
            if (total === 0) return [0, 0, 0, 0, 0, 0, 0];
            
            // Distribute total across 7 months
            const monthly = [];
            let remaining = total;
            
            for (let i = 0; i < 6; i++) {
                const max = Math.min(remaining, Math.ceil(total / 3));
                const value = Math.floor(Math.random() * max);
                monthly.push(value);
                remaining -= value;
            }
            
            monthly.push(remaining); // Last month gets whatever is left
            return monthly;
        }
        
        // Update weekly table
        function updateWeeklyTable(stats) {
            const tableBody = document.getElementById('weeklyTable');
            
            // Clear existing rows except the no-data row
            const existingRows = tableBody.querySelectorAll('tr:not(#weeklyNoData)');
            existingRows.forEach(row => row.remove());
            
            // Show no data message if all stats are 0
            if (stats.keys === 0 && stats.snags === 0 && stats.visits === 0 && 
                stats.handovers === 0 && stats.moveins === 0) {
                document.getElementById('weeklyNoData').classList.remove('d-none');
                return;
            }
            
            // Hide no data message
            document.getElementById('weeklyNoData').classList.add('d-none');
            
            // Create one row with current period's data
            const row = document.createElement('tr');
            
            // Get current period label
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const periodLabel = `${startDate} to ${endDate}`;
            
            // Calculate efficiency (simple formula for demo)
            const efficiency = stats.handovers > 0 ? 
                Math.min(100, Math.round((stats.handovers / (stats.keys || 1)) * 100)) : 0;
            
            row.innerHTML = `
                <td><strong>Current Period</strong></td>
                <td>${stats.keys}</td>
                <td>${stats.snags}</td>
                <td>${stats.visits}</td>
                <td>${stats.handovers}</td>
                <td>${stats.moveins}</td>
                <td>${stats.avgTime}</td>
                <td>
                    <span class="badge ${efficiency >= 80 ? 'bg-success' : efficiency >= 60 ? 'bg-warning' : 'bg-danger'}">
                        ${efficiency}%
                    </span>
                </td>
            `;
            
            tableBody.appendChild(row);
        }
        
        // Generate report
        function generateReport(type) {
            if (!hasRealData) {
                alert('No data available to generate reports. Please add data first.');
                return;
            }
            
            let reportContent = '';
            let filename = '';
            
            switch(type) {
                case 'pending_snags':
                    reportContent = generatePendingSnagsReport();
                    filename = 'Pending_Snags_Report';
                    break;
                case 'productivity':
                    reportContent = generateProductivityReport();
                    filename = 'Productivity_Report';
                    break;
                case 'trends':
                    reportContent = generateTrendsReport();
                    filename = 'Trend_Analysis_Report';
                    break;
                case 'alerts':
                    reportContent = generateAlertsReport();
                    filename = 'Alerts_Summary_Report';
                    break;
            }
            
            // Download report
            downloadReport(reportContent, filename);
        }
        
        // Generate pending snags report
        function generatePendingSnagsReport() {
            // Get actual data
            const stats = calculateStatistics(getHOTData(), 
                document.getElementById('startDate').value,
                document.getElementById('endDate').value);
            
            return `PENDING SNAGS REPORT
Generated: ${new Date().toLocaleString()}
Date Range: ${document.getElementById('startDate').value} to ${document.getElementById('endDate').value}

SUMMARY:
- Total Snags Identified: ${stats.snags}
- Completed: ${stats.snagStatus.completed}
- Pending: ${stats.snagStatus.pending}
- Delayed: ${stats.snagStatus.delayed}

TOWER-WISE PENDING:
- Tower A: ${stats.byTower.A.snags - (stats.snagStatus.completed || 0)} pending
- Tower B: ${stats.byTower.B.snags - (stats.snagStatus.completed || 0)} pending
- Tower C: ${stats.byTower.C.snags - (stats.snagStatus.completed || 0)} pending

RECOMMENDATIONS:
1. Follow up with project team
2. Schedule reinspection
3. Update CRM system`;
        }
        
        // Generate productivity report
        function generateProductivityReport() {
            const stats = calculateStatistics(getHOTData(), 
                document.getElementById('startDate').value,
                document.getElementById('endDate').value);
            
            const efficiency = stats.handovers > 0 ? 
                Math.round((stats.handovers / (stats.keys || 1)) * 100) : 0;
            
            return `PRODUCTIVITY REPORT
Generated: ${new Date().toLocaleString()}
Date Range: ${document.getElementById('startDate').value} to ${document.getElementById('endDate').value}

PERFORMANCE METRICS:
- Key Handovers: ${stats.keys}
- Snagging Completed: ${stats.snags}
- First Visits: ${stats.visits}
- Handovers: ${stats.handovers}
- Move-ins: ${stats.moveins}

EFFICIENCY METRICS:
- Overall Efficiency: ${efficiency}%
- Average Snag-to-Handover Time: ${stats.avgTime} days
- Completion Rate: ${stats.snags > 0 ? Math.round((stats.snagStatus.completed / stats.snags) * 100) : 0}%

RECOMMENDATIONS:
1. Focus on reducing snag resolution time
2. Improve handover process efficiency
3. Monitor key metrics regularly`;
        }
        
        // Download report
        function downloadReport(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            alert(`Report "${filename}" generated and downloaded!`);
        }
        
        // Print dashboard
        function printDashboard() {
            window.print();
        }
    </script>
</body>
</html>
